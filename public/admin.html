<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê´€ë¦¬ì í˜ì´ì§€ - ì¹´ë“œ ëª©ë¡</title>
  <style>
    table { width:100%; border-collapse:collapse; }
    th, td { border:1px solid #ccc; padding:8px; text-align:center; }
    img { max-width:100px; }
  </style>
</head>
<body>
  <h1>ğŸ›¡ï¸ ì¹´ë“œ ëª©ë¡</h1>
  <input id="search" placeholder="ìˆ˜ë¹„ë ¥ ê²€ìƒ‰" />
  <table>
    <thead>
      <tr>
        <th>ì´ë¯¸ì§€</th>
        <th>ì „í™”ë²ˆí˜¸</th>
        <th>ìˆ˜ë¹„ë ¥</th>
        <th>ê´€ë¦¬</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <script>
    let data = [];
    async function load() {
      const res = await fetch('/submissions');
      data = await res.json();
      render(data);
    }
    function render(list) {
      const tbody = document.getElementById('tbody');
      tbody.innerHTML = '';
      list.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><img src="${item.image_url}" /></td>
          <td>${item.phone}</td>
          <td>${item.defense}</td>
          <td>
            <button onclick="sendSMS('${item.phone}')">ì „ì†¡</button>
            <button onclick="del(${item.defense})">ì‚­ì œ</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }
    async function sendSMS(to) {
      await fetch('/sms', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({to,msg:'ì¹´ë“œ ë°œì†¡ ì™„ë£Œ'})});
      alert('ë¬¸ì ì „ì†¡');
    }
    async function del(def) {
      await fetch(`/submissions/${def}`, { method:'DELETE' });
      load();
    }
    document.getElementById('search').addEventListener('input', e => {
      const kw = e.target.value;
      render(kw ? data.filter(x=>x.defense.toString().includes(kw)) : data);
    });
    window.onload = load;
  </script>
</body>
</html>