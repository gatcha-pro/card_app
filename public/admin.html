<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>관리자 페이지 - 카드 목록</title>
  <style>
    table { width:100%; border-collapse:collapse; }
    th, td { border:1px solid #ccc; padding:8px; text-align:center; }
    img { max-width:100px; }
  </style>
</head>
<body>
  <h1>🛡️ 카드 목록</h1>
  <input id="search" placeholder="수비력 검색" />
  <table>
    <thead>
      <tr>
        <th>이미지</th>
        <th>전화번호</th>
        <th>수비력</th>
        <th>관리</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <script>
    let data = [];
    async function load() {
      const res = await fetch('/submissions');
      data = await res.json();
      render(data);
    }
    function render(list) {
      const tbody = document.getElementById('tbody');
      tbody.innerHTML = '';
      list.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><img src="${item.image_url}" /></td>
          <td>${item.phone}</td>
          <td>${item.defense}</td>
          <td>
            <button onclick="sendSMS('${item.phone}')">전송</button>
            <button onclick="del(${item.defense})">삭제</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }
    async function sendSMS(to) {
      await fetch('/sms', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({to,msg:'카드 발송 완료'})});
      alert('문자 전송');
    }
    async function del(def) {
      await fetch(`/submissions/${def}`, { method:'DELETE' });
      load();
    }
    document.getElementById('search').addEventListener('input', e => {
      const kw = e.target.value;
      render(kw ? data.filter(x=>x.defense.toString().includes(kw)) : data);
    });
    window.onload = load;
  </script>
</body>
</html>